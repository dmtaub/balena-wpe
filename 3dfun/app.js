!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},r={},i={},n={}.hasOwnProperty,a=/^\.\.?(\/|$)/,o=function(e,t){for(var r,i=[],n=(a.test(t)?e+"/"+t:t).split("/"),o=0,s=n.length;o<s;o++)r=n[o],".."===r?i.pop():"."!==r&&""!==r&&i.push(r);return i.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},h=function(t){return function(r){var i=o(s(t),r);return e.require(i,t)}},c=function(e,t){var i=y&&y.createHot(e),n={id:e,exports:{},hot:i};return r[e]=n,t(n.exports,h(e),n),n.exports},p=function(e){return i[e]?p(i[e]):e},d=function(e,t){return p(o(s(e),t))},u=function(e,i){null==i&&(i="/");var a=p(e);if(n.call(r,a))return r[a].exports;if(n.call(t,a))return c(a,t[a]);throw new Error("Cannot find module '"+e+"' from '"+i+"'")};u.alias=function(e,t){i[t]=e};var l=/\.[^.\/]+$/,m=/\/index(\.[^\/]+)?$/,f=function(e){if(l.test(e)){var t=e.replace(l,"");n.call(i,t)&&i[t].replace(l,"")!==t+"/index"||(i[t]=e)}if(m.test(e)){var r=e.replace(m,"");n.call(i,r)||(i[r]=e)}};u.register=u.define=function(e,i){if(e&&"object"==typeof e)for(var a in e)n.call(e,a)&&u.register(a,e[a]);else t[e]=i,delete r[e],f(e)},u.list=function(){var e=[];for(var r in t)n.call(t,r)&&e.push(r);return e};var y=e._hmr&&new e._hmr(d,u,t,r);u._cache=r,u.hmr=y&&y.wrap,u.brunch=!0,e.require=u}}(),function(){"undefined"==typeof window?this:window;require.register("clib.coffee",function(e,t,r){var i,n,a,o,s,h,c,p,d,u,l,m,f,y=function(e,t){function r(){this.constructor=e}for(var i in t)w.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},w={}.hasOwnProperty,E=function(e,t){return function(){return e.apply(t,arguments)}};t("three.terrain.js"),c=.5,o=.8,h=22,p=.6,f=20,d=new THREE.Vector3(20,5e3,20),u=d.clone().multiplyScalar(-1),s=8871725,m=function(e,t){var r;return r=t-e+1,t-Math.round(Math.random()*r-.5)},a=function(){function e(){this.weight=m(6,10)}return e.prototype.weight=9,e.prototype.barkColor=s,e.prototype.fallOver=function(e){return console.log("OUCH!")},e}(),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return y(t,e),t.prototype.weight=20,t}(a),l=new a,i=function(){function e(){this.createShape=E(this.createShape,this),this.render=E(this.render,this),this.moveWithKeys=E(this.moveWithKeys,this),this.initScene=E(this.initScene,this),console.log("hello coffee"),this.initScene(),window.addEventListener("resize",function(e){return function(){return e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(window.innerWidth,window.innerHeight)}}(this),!1)}var t;return e.prototype.initScene=function(){var e,r,i;TWEEN.start(),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMapSoft=!0,document.getElementById("viewport").appendChild(this.renderer.domElement),this.scene=new Physijs.Scene({fixedTimeStep:1/60}),this.scene.setGravity(new THREE.Vector3(0,(-40),0)),this.scene.addEventListener("update",function(e){return function(){var t,r,i;e.scene.simulate(void 0,1),e.playerCamera&&(t=e.player.position.x+20,r=e.player.position.y+20,i=e.player.position.z+20,e.camera.position.set(t,r,i),e.camera.lookAt(e.player.position)),e.player.position.y<-20&&(e.scene.remove(e.player),e.player=e.createShape(),e.scene.add(e.player))}}(this)),i=2.5,this.camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.set(60*i,50*i,60*i),this.camera.lookAt(this.scene.position),this.scene.add(this.camera),this.playerCamera=!1,kd.ESC.up(function(e){return function(){return e.playerCamera?(e.playerCamera=!1,e.camera.position.set(60*i,50*i,60*i),e.camera.lookAt(e.scene.position)):e.playerCamera=!0}}(this)),r=new THREE.DirectionalLight(16777215),r.position.set(20,40,-15),r.target.position.copy(this.scene.position),r.castShadow=!0,r.shadow.camera.left=-60,r.shadow.camera.top=-60,r.shadow.camera.right=60,r.shadow.camera.bottom=60,r.shadow.camera.near=20,r.shadow.camera.far=200,r.shadow.bias=-1e-4,r.shadow.mapSize.width=r.shadow.mapSize.height=2048,this.scene.add(r),e=new t(this.scene,function(e){return function(){return requestAnimationFrame(e.render),e.scene.simulate(),e.player=e.createShape(),e.player.setDamping(c,o),e.scene.addEventListener("update",e.moveWithKeys)}}(this))},e.prototype.moveWithKeys=function(){var e,t,r;r=this.player.getLinearVelocity(),t=this.player.getAngularVelocity(),e=this.player._physijs.touches.length>0,kd.RIGHT.isDown()&&(r.x+=p,r.z-=p,e?(t.x-=f,t.z-=f):(t.x=0,t.z=0)),kd.LEFT.isDown()&&(r.x-=p,r.z+=p,e?(t.x+=f,t.z+=f):(t.x=0,t.z=0)),kd.UP.isDown()&&(r.x-=p,r.z-=p,e?(t.x-=f,t.z+=f):(t.x=0,t.z=0)),kd.DOWN.isDown()&&(r.x+=p,r.z+=p,e?(t.x+=f,t.z-=f):(t.x=0,t.z=0)),kd.SPACE.isDown()&&e&&(r.y=h),t.clamp(u,d),r.clamp(u,d),this.player.setAngularVelocity(t),this.player.setLinearVelocity(r)},e.prototype.render=function(){requestAnimationFrame(this.render),this.renderer.render(this.scene,this.camera)},e.prototype.createShape=function(){var e,t;return t=new THREE.SphereGeometry(1.5,32,32),e=void 0,(e=function(e){return function(){var r,i;return i=void 0,r=new THREE.MeshLambertMaterial({opacity:0,transparent:!0}),i=new Physijs.SphereMesh(t,r,(void 0),{restitution:1.5*Math.random()}),i.material.color.setRGB(100*Math.random()/100,100*Math.random()/100,100*Math.random()/100),i.castShadow=!0,i.position.set(30*Math.random()-15,20,30*Math.random()-15),i.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),e.scene.add(i),new TWEEN.Tween(i.material).to({opacity:1},1500).start(),i}}(this))()},t=function(){function e(e,t){this.afterLoad=t,this.addEarth=E(this.addEarth,this),this.regenerate=E(this.regenerate,this),this.addSky=E(this.addSky,this),this.scatterMeshes=E(this.scatterMeshes,this),this.addDefault=E(this.addDefault,this),this.addEarth(e,this.afterLoad)}return e.TextureLoader=new THREE.TextureLoader,e.prototype.xS=63,e.prototype.yS=63,e.prototype.xSize=128,e.prototype.ySize=128,e.prototype.maxHeight=30,e.prototype.minHeight=20,e.prototype.addDefault=function(e){return this.material=new THREE.MeshBasicMaterial({color:5596842}),this.regenerate(e)},e.prototype.scatterMeshes=function(){var e,t;return t=this.terrainScene.children[0].geometry,e=THREE.Terrain.ScatterMeshes(t,{mesh:new THREE.Mesh(new THREE.CylinderGeometry(2,2,12,6)),w:this.xS,h:this.yS,spread:.02,randomness:Math.random}),this.terrainScene.add(e)},e.prototype.addSky=function(t){return e.TextureLoader.load("img/sky1.jpg",function(e){var r;return e.minFilter=THREE.LinearFilter,r=new THREE.Mesh(new THREE.SphereGeometry(8192/12,16,16,0,2*Math.PI,0,.5*Math.PI),new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1})),r.position.y=0,r.rotation.x=Math.PI,t.add(r)})},e.prototype.regenerate=function(e){var t,r,i;return this.terrainScene=THREE.Terrain({easing:THREE.Terrain.Linear,frequency:2.5,heightmap:THREE.Terrain.DiamondSquare,material:this.material||new THREE.MeshLambertMaterial({color:2200782}),maxHeight:this.maxHeight,minHeight:-this.minHeight,steps:10,useBufferGeometry:!1,xSegments:this.xS,xSize:this.xSize,ySegments:this.yS,ySize:this.ySize}),this.terrainScene&&e.remove(this.terrainScene),t&&e.remove(t),i=Physijs.createMaterial(new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.02,wireframe:!0})),r=this.terrainScene.children[0].geometry,console.log(r),r.computeFaceNormals(),r.computeVertexNormals(),t=new Physijs.HeightfieldMesh(r,i,0,this.xS,this.yS),t.rotation.x=Math.PI/-2,this.terrainScene.children[0].receiveShadow=!0,e.add(t),e.add(this.terrainScene)},e.prototype.addEarth=function(t,r){var i;return i=e.TextureLoader,i.load("img/sand1.jpg",function(e){return function(n){return i.load("img/grass1.jpg",function(a){return i.load("img/stone1.jpg",function(o){return i.load("img/snow1.jpg",function(i){if(e.material=THREE.Terrain.generateBlendedMaterial([{texture:n},{texture:a,levels:[-15,-10,-5,0]},{texture:o,levels:[-20,0,10,15]},{texture:i,glsl:"1.0 - smoothstep(5.0 + smoothstep(-256.0, 256.0, vPosition.x) * 10.0, 28.0, vPosition.z)"},{texture:o,glsl:"slope > 0.7853981633974483 ? 0.2 : 1.0 - smoothstep(0.47123889803846897, 0.7853981633974483, slope) + 0.2"}]),e.regenerate(t),r)return r()})})})}}(this))},e}(),e}(),r.exports=i}),require.register("initialize.js",function(e,t,r){App=t("clib"),document.addEventListener("DOMContentLoaded",function(){console.log("Initialized brunch app"),new App})}),require.alias("buffer/index.js","buffer"),require.register("___globals___",function(e,t,r){window.THREE=t("three")})}(),require("___globals___");